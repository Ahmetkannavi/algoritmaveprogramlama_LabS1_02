digraph HospitalSystem {
    rankdir=TB;
    node [shape=rectangle, style=rounded, fontsize=11];

    start [label="BAŞLA"];
    tc_input [label="TC Kimlik No gir"];
    tc_check [shape=diamond, label="TC geçerli mi?"];
    menu [label="1-Randevu Al\n2-Tahlil Sonucu Gör\n3-Çıkış"];
    choice_check [shape=diamond, label="Seçim?"];
    exit [label="Sistemden çıkış"];
    end [shape=oval, label="BİTİR"];

    // --- Randevu Modülü ---
    poly_select [label="Poliklinik seç"];
    doctor_list [label="Doktor listesini görüntüle"];
    doctor_select [label="Doktor seç"];
    time_loop [label="Uygun saatleri göster (DÖNGÜ)"];
    time_check [shape=diamond, label="Saat uygun mu?"];
    create_app [label="Randevu oluştur\nSMS gönder"];
    time_full [label="Saat dolu!"];
    
    // --- Tahlil Modülü ---
    test_check [shape=diamond, label="Tahlil var mı?"];
    ready_check [shape=diamond, label="Tahlil hazır mı?"];
    show_result [label="Sonuçları görüntüle"];
    download_ask [label="PDF indirilsin mi?"];
    download_yes [label="PDF indirildi"];
    download_no [label="İndirme iptal"];
    not_ready [label="Tahlil henüz hazır değil"];
    no_test [label="Tahlil kaydı bulunamadı"];

    again [label="Başka işlem yapmak ister misiniz? (E/H)"];
    invalid [label="Geçersiz seçim"];

    // --- Akış bağlantıları ---
    start -> tc_input -> tc_check;
    tc_check -> menu [label="Evet"];
    tc_check -> end [label="Hayır"];

    menu -> choice_check;

    choice_check -> poly_select [label="1: Randevu Al"];
    choice_check -> test_check [label="2: Tahlil Sonucu Gör"];
    choice_check -> exit [label="3: Çıkış"];
    choice_check -> invalid [label="Diğer"];

    // --- Randevu akışı ---
    poly_select -> doctor_list -> doctor_select -> time_loop -> time_check;
    time_check -> create_app [label="Evet"];
    time_check -> time_full [label="Hayır"];
    create_app -> again;
    time_full -> time_loop;

    // --- Tahlil akışı ---
    test_check -> ready_check [label="Evet"];
    test_check -> no_test [label="Hayır"];
    ready_check -> show_result [label="Evet"];
    ready_check -> not_ready [label="Hayır"];
    show_result -> download_ask;
    download_ask -> download_yes [label="Evet"];
    download_ask -> download_no [label="Hayır"];
    download_yes -> again;
    download_no -> again;
    not_ready -> again;
    no_test -> again;

    // --- Döngüler ---
    invalid -> again;
    again -> menu [label="Evet"];
    again -> exit [label="Hayır"];
    exit -> end;
}
